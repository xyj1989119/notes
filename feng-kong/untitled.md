# 风控要点

## 埋点

## 数据统计

多维度统计，例如根据用户统计登录次数、登录设备数；根据设备号统计登录用户数、登录次数；根据IP统计登录用户数、登录次数、登录设备数。

统计所有触发规则的记录，比如用户重试密码的次数，从而推断出人与机器之间的阈值。频率类的策略在风控中就有着非常重要的作用。考虑频率特征时，通常考虑几个因素，分别是：时间窗口、资源、运算与阈值。

> 在7天内同一用户使用IP的数量大于15。这里面7天内就代表着**时间窗口**，用户与IP就代表着黑产使用的**资源**，数量就是**运算**，大于15就是**阈值**。

4个核心因素都是通过对黑产行为的分析而不断调整的：

* 时间窗口可以是：秒、分、时、天、月、季度、年。
* 资源可以是：userid、infoid、ip、ua、cookie、设备、手机号、邮箱等等任何具有唯一性特点的实体。
* 运算可以是：求和、平均值、最大值、最小值等各种运算方法。
* 阈值的确定就是针对准召率表现来选择出最优解。

1. 为什么昨天凌晨1点的订单比均值高？ 
2. 为什么最近有很多连续的IP访问我们？ 
3. 地理位置的异常偏移

   比如ip的归属地和设备的定位差距过大，地理位置变化的速度过快。关于地理位置的特征选取基于的基本理念就是用户不会在短时间内位置发生大幅变化，如果变化的幅度过大或者过快都会存在一定风险，说明可能通过作弊手段修改定位，使用代理ip等等。

4. 前端数据的采集异常

   比如正常用户在填写某一个表单时，势必会在PC端留下鼠标移动的行为，app端产生滑动的行为等。但是如果我们发现一个PC端的表单提交，用户的鼠标从来就没有做过任何移动，或者移动的轨迹非常相似，这个时候就会与我们的常规认知产生冲突。这种冲突通常就会发现很多黑产的蛛丝马迹。

5. 现有的风控规则触发的记录，包含策略、命中次数和命中的详细记录
   1. 登录失败记录
6. 新增触发规则
   1. 限制每天用户输错密码的次数，用以控制密码暴力破解
   2. 限制每台设备领用优惠券的次数，用以控制普通用户注册多个账号刷券
   3. 限制每张银行卡每天的消费金额，用以控制盗号
   4. 每天只能错15次
   5. 过滤海外IP。大量代理IP来自海外，例如委内瑞拉、荷兰、印度尼西亚、美国。对海外IP进行二次校验，可以快速增加黑产的成本 
   6. 爬取公开代理IP。很多网站会提供免费的代理IP，我们可以用爬虫爬取这些IP，进行拦截
7. 根据数据统计出机器和普通用户之间的阈值，例如用户输错密码的次数应该呈现正态分布，两头少，中间多，如果到了一个值之后次数突然增多则是人与机器的阈值
8. 增加灰、黑名单，触发某些规则或人为进入灰名单并标上等级，如到达某个等级则在下次登录后身份认证一下或者手机、邮件提醒；常见的黑名单有用户ID、设备号、手机号码、地址、银行卡号、IP、城市、国家等

   **第三方威胁情报**

   在安全领域中，我们将这些高危名单、黑名单进行整理，称作威胁信息或者威胁情报。如果你还未积累起足够的威胁情报，又急需补足这个短板，你可以选择向第三方公司购买。

   国内比较有名气的第三方情报公司有\(排名不分先后\)：

   * [微步在线](https://x.threatbook.cn/)
   * [同盾科技](https://www.tongdun.cn/)
   * [邦盛科技](http://www.bsfit.com.cn/)
   * [蚂蚁金服 蚁盾](https://b.alipay.com/order/productDetail.htm?productId=2016040624336707)
   * [威胁猎人](https://threathunter.cn/)

   **开放的名单**

   我们除了从自己公司的数据中统计高危名单，也会参考其他公司开放的数据。因为黑产通常会在不同网站重复使用一个手机号、IP、银行卡，使用开放数据意味着你不需要从头开始。

   例如：

   * 携程安全云 [https://security.ctrip.com/](https://security.ctrip.com/)
   * 阿里云IP表 [http://www.tcpiputils.com/browse/as/37963](http://www.tcpiputils.com/browse/as/37963)

## 处罚的选择

阿里对待安全有一个九字方针叫“轻管控，重检测，快相应”。其中的轻管控说的是，要尽可能地避免安全对用户体验的伤害，让正常用户受到的影响最小化，其实这个就是所有处罚选择过程中的一个基调。

#### 1. 处罚体系的设计

关于处罚体系的设计，我们需要先给处罚做一个定义，处罚就是针对用户的应有权利进行限制的过程。

所以要想知道应该怎么处罚，就应该明确用户拥有着什么样的权利，通过定义权利的集合就可以相对的定义处罚。

以58同城的业务为例，一个用户拥有着以下的权利：注册的权利、登录的权利、搜索的权利、浏览的权利、发帖的权利、被浏览的权利，推广的权利、成为会员的权利、IM聊天的权利等等。

假设上面所列出来的就是58用户拥有着的权利全集，那么在设计处罚体系的时候就可以做如下设计：禁止注册、禁止登录、限制浏览与搜索、限制发帖、删帖、降权、限制推广、会员禁签，IM禁言等等。

结合用户所犯错误的轻重程度，通过上面的单一的处罚或者组合处罚，就可以实现有效的风险控制。

#### 2. 处罚的应用方法

根据处罚的性质，我们大致可以将所有的处罚大致可以分为三类：第一种叫做标记、第二种叫做挑战、第三种叫惩罚。

**A. 标记**

标记一般是指给用户或资源打上一个标签，但是不做任何实际上的处理。通常是应用在风控路径比较短的业务中，如果这个场景在整个业务链路中处于靠前的位置，那么代表着可以获取到的数据会比较有限，而且路径越短，直接处理就会降低黑产的试错成本，从而加大风控难度。

比如常见的注册业务，如果我们一旦发现注册的用户存在问题，就直接禁止用户完成注册。我们就相当于直接告诉黑产目前的方法不能通过，那么黑产在频繁尝试的过程中只要突破一次，就可以完全突破我们的风控防线。

所以在这种场景里，我们通常不实际对用户产生影响，而是根据用户的行为打上标记，这个标记会作为一种特征存在贯穿整个业务链路。我们实时地观测有标记用户后续的表现，一旦在后续的业务中存在更多的异常行为，就可以直接处罚。这个时候黑产很难搞懂我们是在什么环节识别出的异常，这样就能提高黑产的成本。

**B. 挑战**

挑战类的处罚一般应用在策略准确率不足，但是直接放过又存在比较大的风险的时候。顾名思义，就是通过一些手段去挑战用户让用户证明自己不是机器人，自己就是这个账号的归属人等等。挑战类处罚因为没有实际影响用户的权利，一旦通过挑战用户就可以完成正常使用功能。所以挑战是一种体验优良的处罚方式，但每一种挑战自身的能力会直接决定对黑产用户的拦截效果。

常见的挑战形式有下面几种：

1）基于验证码的挑战

图形验证码多用于区分人和机器人，用来防止大批量的机器刷帖等情况。短信或语音验证码主要用于证明当前号码是本人操作。

主要的验证码形式有：字符验证码、滑动验证码、点选验证码、无感知验证码、短信验证码、语音验证码等。

下面针对各种验证码的适用逻辑和有效性做一个介绍：

字符验证码：最初级的验证码，让用户回填图片中字符或者计算出算式结果。这种验证码破解难度极低，在黑产业内已经能达到98%以上的通过率，这个通过率已经超过了人类本身。所以在任何场景都不推荐这种验证码。

滑动验证码：该验证方式最初来源于“极验验证”。

![](http://image.woshipm.com/wp-files/2019/04/m8DCTrhCFtStkroLcj5d.jpeg)

这种验证码是通过拖动X轴上的滑块进行验证，后端同时会对前端浏览器环境和滑动轨迹进行分析判断，用以拦截异常机器行为，体验上要大幅优于常规的字符验证码。但是这种形式的验证码依然可以被很多打码平台破解，或者通过滑动轨迹的模拟进行破解。

点选验证码：最有名的点选型验证码就是12306的验证码了，这种验证码其实是利用了人类的认知能力与机器认知能力的偏差，比如在看到一个动物的时候，人类可以轻易地区分出这个动物是小猫还是小狗，而这个能力对于机器来说极其困难。这种验证码机器直接破解相对困难，但是通过打码平台依然可以低成本地绕过。

![](http://image.woshipm.com/wp-files/2019/04/BxzxffMFyxYFWug413Bm.jpeg)

无感知验证码：无感知验证码其实就是将一整套风控策略放到一个按钮上，极验验证的表现形式是这样的：

![](http://image.woshipm.com/wp-files/2019/04/q0B1KxtHsBk8CCJSDtJD.jpeg)

当点击按钮进行验证时，通过前端采集各种数据传到后端的风控引擎中，只要检测的速度足够快，用户就可以非常迅速地完成验证。这种验证看起来体验极其优秀，但是实际上只是把后端的检测能力具象化了，所以说有这个按钮或者没有这个按钮并没有实质区别。这种验证码的破解难度直接跟后端的风控能力相关，无法直接给出容易破解或者难以破解的结论。

短信验证码：这种验证码可以说是我们最常见的验证码形式了，它的好处是安全，体验也不差，通过验证码的回填可以大概率确定操作是本人进行。但是通常在注册等环节第一次需要做短信验证的时候，可以通过猫池手机号来完成验证。这种手机卡不同于普通手机卡，是无法接通电话但是可以接收短信的，所以就会黑产大规模地采用这种手机卡完成注册。

语音验证码：为了解决部分猫池手机接受验证码的问题，语音验证码应运而生，这种验证码通过电话下发，用户记住数字后完成回填。语音验证码的体验相对较差，一般非必要不推荐这种验证形式。

2）基于身份合规性的挑战

在很多时候，我们发现作弊的用户没有做过任何实名或者可以证明身份的动作。一般这个时候，我们会让某些风险较大但是又无法判断为黑的用户进行实名认证和企业认证，这种需求也可能来源于业务的硬性规则。

一般做个人实名的方式有：实名二要素认证，手持身份证认证，银行卡认证，手机号三要素认证，人脸认证等。

企业认证的方式通常是营业执照认证和对公账号打款认证。

我们建议业务方在开展新业务的时候，一定要关注认证的相关要求，认证一方面作为一个门槛可以大幅提升黑产成本，另一方面认证也可以作为唯一性的特征供我们进行风控识别。

3）基于私密信息的挑战

这种挑战多用于账号安全或密码找回。当我们判断当前使用账号的人可能不是用户本人时，就可以通过这种方式进行挑战。

常见的问题有“我的父亲名字叫什么？”“我最常用的银行卡号是哪张？”这种挑战方式通过只有用户自己知道的信息来挑战当前的操作人，如果当前操作人无法通过，那么就代表当前操作人非用户本人。

![](http://image.woshipm.com/wp-files/2019/04/AphYv4Ek0qEYzgncRr89.jpeg)

这种挑战方式体验相当优秀，并且通过信息的不对称性有效地防止了风险发生，所以当用户在业务中已经存在一些关键信息时，可以考虑用这种方式进行挑战。

以上就是常见的挑战形式，不同的挑战形式适用的场景和条件都有所不同，所以对能力的了解也是做好风控的前提。

**C. 惩罚**

当我们可以对用户的行为明确定义为恶意行为的时候，这个时候采取的动作通常就都属于惩罚了。

我们在看待用户的恶意行为时应该从两个维度去考虑，第一种是用户确实是正常用户，只是为了获取一些短期利益触犯了平台规则。另一种是用户为批量恶意的黑产用户，就是为了攫取流量诈骗变现。

在对待第一种用户时，我们的处罚态度应该是引导大于处罚，这个时候我们可以将处罚柔性化，比如淘宝商家违规分值体系就是一个比较成功的例子。

当用户初犯的时候可能是下架出问题的商品并且扣分，多次触犯规则后，当分值达到一定程度时可能会对搜索降权，再犯可能是暂时关店，最后可能才是永久清退。我们通过相对柔性的处罚，既处罚了不良行为本身，但同时也给用户一个改进的空间和机会，通过积极的运营引导是可以把这部分用户转化为优质用户的。

而对待明确的黑产用户时，我们的处罚态度就应该是明确和清晰的。一旦确保了判定的准确性，我们不光要把账号的权利做限制，账号所相关的一切有效资源比如手机号、邮箱、身份证号都要被有效地消耗掉，确保同样的资源不会在业务中二次作恶。我们处罚生效得越快，资源消耗得越彻底，风险出现的可能性就越小。

所以整体来说，处罚既要让正常用户尽量不受任何影响，又要高效地消耗黑产资源，并且对处于灰色地带的用户给予积极引导，让这种用户自觉发生改变从而促进生态发展。

